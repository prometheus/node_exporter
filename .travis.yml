sudo: false

language: go

go:
  - 1.13.x
  - master

env:
  - GO111MODULE=off
  - GO111MODULE=on
  - secure: "Hcjd9UffGZbx0THcBD+t5y5steBs059jvg+VdatHjjY25LcYNZtTAsntB91E459M820/y+/ckAfTnmBbPDuAbkrc4q4IOJRs1PYul0GxKEAhPMLY/jYPpT5adw6U/IkOiTRX/yDBvn5rCtzo92uCSTkaHTDmfR2xyUXXlB7HmUiyYQb5peUOvJCrmpeSKqq1xTNcF95a9Ny4eibbGhL86BRHsjkBnCVhEL/gxyDZy5ahqr18lRZEZiOrVqETJhRnjVsYT5hu7rpkLelaMMCAtei9baLT8c0EPcnrT90yASLpTBVbK14IkQCfFbaHmn0aSrE6uo7Rh1PR6aB3sYBGo7cmaKPUJUIoP2NKCGwR/n8duWs6nTfdTtzxH6x3xQxNJb0zy5xmCLK5WykyX6F9YMjP57W5dgRWpYab0pSWVgvXxCXNI2J/1Kc1bQWciDXCnrgv9RoxQZBi2dspp83FhZeJa8zhHv9OTIwXEfnHpAo8aeU1/CdxT4sd98gC/dnZo2DcYqY0q5OoTo5VmPdvFghL1hOoYlqM3eOfbCZIvMwet1uOet1rOeVNsPC1P8+BR5k8Mod8NG8wuIjmJ7nT19Q9G/ihyLurzMUQTsidNrAZW+Ljmd2LFo6OYJUfe7MC7vNK5Vosn/YyKwtNVeFMWafAPudCxZLcc4y6AxY6LkI="

matrix:
  allow_failures:
    - go: master

# skip non-trunk PMM-XXXX branch builds, but still build pull requests
branches:
  except:
    - /^PMM\-\d{4}/

go_import_path: github.com/prometheus/node_exporter

install:
  # install reviewdog and golangci-lin
  - curl https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
  - curl https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s latest

before_script:
  # static analyze
  - bin/golangci-lint run -c=.golangci-required.yml --out-format=line-number | bin/reviewdog -f=golangci-lint -level=error -reporter=github-pr-check
  - bin/golangci-lint run -c=.golangci.yml --out-format=line-number | bin/reviewdog -f=golangci-lint -level=error -reporter=github-pr-review

script:
  - go install -v ./...

notifications:
  slack:
    on_success: change
    on_failure: always
    rooms:
      secure: aAvT7rqWGIb0rU171jIk6MaClH+HI8MjIxNBjxrtmdg6tgQ9NKjkazGSr0ZPEce7GJDLgRtM9EPtms7zHrVY7Z6QsA+cdnIPDqqdNL5THTDyKIBRaRGrgyMmPd4MOV7WKQEKOf7/+hZq1CyDqPL8lIc2b0nDkCBOjTYf83fe3bviNEcrMxC1x1jHPJLfziPa7P0B2/BdkTRsP7yMLlTvp1D4zofvbmMIyN0tlXI6USacxbGSHtOTtyJlmOSMCH4IfpU7eMNzyl/FVPAkUSbkaF7loEbbLtOm0GTMmvM5RzUbcLyfPzQf1Yy6h0iAdgbtBQFtO6jWyN6zkyi9IRZqlmDSlgTI8YRei5hPzxoHDR9owKacvYMlm6V73aRdD9yLoplgX5QZ54NVqLPfs6InH/z/Rdp/shiuD/InCjR4GJBZDn1vKSZOLCCT/PnT562qhDOwgv6Rnmasb2Rh7PKKSgJ4KBJaaB0SsMc27QdieD3e0sXds0KTRLvwdkJAzSoEK0FNyrm9UzLWlnUcGO4t3oEcU0iNWT7+3xh5S8nG6TCgz4oMjd4nUuU1jIGG/Zuzg64vIZTsI64lpY8Ps1AUJ2X2AyPtVmFhCgVJZg7/SUUvFOH2jyGjK8GDb0NB2U8wd75e74AEvmwatYK7YidoUm80XWvp3epMnzRTRa/Mhw4=
